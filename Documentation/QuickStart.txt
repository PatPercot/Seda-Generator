Guide de démarrage rapide du générateur de bordereaux de transfert

1) Installation du logiciel
2) Instrumentation d'un profil d'archivage
3) Préparation des données métier
4) Génération un bordereau de transfert




***************************************************************************************
1) Installation du logiciel

	Si vous êtes sous Linux, bonne nouvelle, les programmes peuvent être exécutés 
	directement sous Mono (installez le paquateg Mono de votre distribution)

1-a) Installation
	Sur la plate-forme GitHub : cliquer sur le bouton "Download ZIP"
	Dézipper le fichier sur votre ordinateur dans un endroit facilement accessible
		(choissez un chemin court, idéalement dans la racine d'un de vos disques)
	Aller dans le répertoire "Programs-Releases" qui contient les exécutables
	Faites une copie du fichier job.config.sample et renommez-la en job.config
	Vous êtes prêt à démarrer.

1-b) Préparation
	Explorez le répertoire "travail" dans le répertoire "Programs-Releases"
	Ce répertoire contient :
		- un répertoire "profils" pour les profils que vous préparez
		- un répertoire "metier" pour les données métier
		- un répertoire "documents" pour les documents à archiver
		- un répertoire "bordereaux" pour les bordereaux générés
		- un répertoire "traces" pour les fichiers de traces (pour les développeurs)
			
			
***************************************************************************************
2) Instrumentation d'un profil d'archivage

2-a ) Préparation
	Vous pouvez partir d'un profil d'archivage existant
	Choisissez un profl simple pour débuter. Limitez-vous à 2 ou 3 unités documentaires.
	Copiez ce profil (le fichier XML, pas le RNG) dans le répertoire "profils"
		Si vous n'avez pas de profil existant vous pourrez utiliser le fichier 
			"CABAN_profil_Sonerion.xml"

2-b) Préparation du fichier job.config
	Ouvrez le fichier job.config avec un "vrai" éditeur de texte (Notepad++ par exemple)
	
	Copiez la section "profile-control" ci-dessous :
[profile-control : CABAN]
  trace = traces/CABAN_profil_Sonerion-traces.txt
  profil = profils/CABAN_profil_Sonerion-schema.rng
  
	Si vous utilisez votre propre profil d'archivage, modifiez le nom de la cible et 
	le nom du fichier de rpofil par le nom de votre fichier de profil 
	  ATTENTION ! par défaut le nom du RNG se termine par :
		-schema.rng
	
2-c) Préparation de la console
	Lancez une console 
		(sous Windows Démarrer / Exécuter : cmd)
		(sous Linux : Terminal)
	Déplacez-vous dans le répertoire Programs-Releases 
		cd Programs-Releases

2-d) Édition du profil
	Lancez le logiciel Agape
	Ouvrez le profil
	
2-e) Génération du RelaxNG
	Générez le profil au format RNG (menu Outils/Générer le schéma du profil)

2-f) Contrôle du profil
	Dans la console, lancez la commande suivante :
		RngProfileControllerLauncher.exe CABAN
	Cette commande traite la section profile-control qui porte le nom CABAN

2-g) Interprétation des résultats
	Les messages sont assez explicites et indiquent ce qui doit être fait
	La balise ArchivalAgencyObjectIdentifier est la première balise des unités documentaires
		(Identifiant unité documentaire service d'archive en français)
	Les TAGs peuvent se trouver dans :
		l'attribut SchemeId de ArchivalAgencyObjectIdentifier
		l'attribut SchemeId de Identifier (6ème balise de Document)
	Les TAGs ont la forme suivante :
		LISTETAGS / TAG 
			où LISTETAGS est le référentiel pour la collectivité ou le profil
			où TAG est la typologie documentaire correspondant à 
				l'unité documentaire ou au document
	Effectuez les modifications préconisées
	Et répétez les étapes 2-e à 2-g jusqu'à ce qu'il n'y ait plus d'erreurs

2-h) Profil sans erreurs
	Le profil travail/profils/CABAN_TAG_profil_Sonerion_schema.rng ne contient pas
	d'erreurs et peut être utilisé pour aider à comprendre comment traiter un
	profil erroné



***************************************************************************************
3) Préparation des données métier

3-a) Précisions utiles
	Le fichier de données est un fichier texte qui liste les données à associer au profil
	pour produire un bordereau
	Chaque ligne commence par un séparateur (noté "sép") qui peut changer à chaque ligne

	Ci-dessous la liste des balises que vous pouvez mettre dans le fichier de données

	Entre crochets, les pseudo balises
	[TransferName]
	Comment
	CustodialHistory
	OriginatingAgency.BusinessType
	OriginatingAgency.LegalClassification
	OriginatingAgency.Description
	OriginatingAgency.Identification
	OriginatingAgency.Name
	[ContainsName]
	[ContainsDescription]
	KeywordContent

	La forme d'une ligne pour une balise est :
		sép BALISE sép VALEUR

	La forme d'une ligne pour un document est :
		sép NOM_FIC sép TAG sép TITRE_DOC sép DATE
		sép NOM_FIC sép TAG sép TITRE_DOC sép DATE sép ALGO sép EMPREINTE sép TAILLE
	où 
		NOM_FIC est le nom du fichier
		TAG est la typologie documentaire du document
		TITRE_DOC est le titre du document
		DATE est la date de création du document
		ALGO est l'algorithme utilisé pour créer l'empreinte
		EMPREINTE est l'empreinte du fichier
		TAILLE est la taille du fichier en octets
	par défaut, ALGO, EMPREINTE et TAILLE sont calclués par le générateur s'il peut avoir accès aux documents

3-b) Contrôler les données métier
	Dans le répertoire "travail/metier" il y a deux fichiers de données.
	Le fichier "CABAN_data-err.txt" contient des erreurs signalées par les lignes
	# Ci-dessous une erreur

	Pour le vérifier, vous pouvez créer une section de contrôle des données dans le 
	fichier job.config :

	[data-control : erreurs]
	  trace = travail/traces/erreurs-trace.txt
	  profil = travail/profils/CABAN_TAG_profil_Sonerion_schema.rng
	  data = travail/metier/CABAN_data-err.txt
  
	Dans la console, tapez la ligne de commande :
		BusinessDataControllerLauncher erreurs
	Le programme vous signale toutes les erreurs contenues dans les données métier

	Vous pouvez les corriger une à une ou utiliser le fichier corrigé "CABAN_data-ok.txt"
	[data-control : ok]
	  trace = travail/traces/ok-trace.txt
	  profil = travail/profils/CABAN_TAG_profil_Sonerion_schema.rng
	  data = travail/metier/CABAN_data-ok.txt
  
	Dans la console, tapez la ligne de commande :
		BusinessDataControllerLauncher ok





***************************************************************************************
4) Génération un bordereau de transfert

Dorénavant, vous avez un profil d'archivage vérifié par le programme de contrôle et 
un fichier de données validé par le programme de contrôle et confronté au profil 
d'archivage.

4-a) Préparation des données du SAE
	Le SEA est paramétré pour un accord de versement
	Certaines données sont nécessaires pour produire le bordereau de transfert
	La section que vous allez ajouter dans job.config représente la configuration
	du SAE.
	
	La clé d'accès à un 
	
	[accord-versement : CABAN]
		SAE_Serveur = http://test
		TransferIdPrefix = PREFIX_CABAN_
		SAE_ProfilArchivage = ./tests/CABAN_TAG_profil_Sonerion_schema.rng
		TransferringAgencyId = 22560001400016
		TransferringAgencyName = Conseil départemental du Morbihan
		TransferringAgencyDesc = Le conseil départemental du Morbihan est l'auteur du programme ProBANT (générateur de bordereaux de transfert)
		ArchivalAgencyId = 22560001400016
		ArchivalAgencyName = Conseil départemental du Morbihan - Archives départementales
		ArchivalAgencyDesc = Les archives départementales du Morbihan conservent les archives définitives du département du Morbihan

4-b) Ajout d'une cible de production de bordereau

	[generator : CABAN]
	  accord = CABAN
	  baseURI = http://test
	  trace = travail/traces/bordereau-trace.txt
	  data = travail/metier/CABAN_data-ok.txt
	  rep_documents = travail/documents/
	  bordereau = travail/bordereaux/CABAN_sonerion.xml
	  
4-c) Production du bordereau
	Dans la console, tapez la ligne de commande :
		SedaSummaryGeneratorLauncher CABAN
	
	En ouvrant le fichier "travail/bordereaux/CABAN_sonerion.xml" vous pourrez constater
	que certaines informations concernant les documents à archiver ont été produites à partir
	des documents enregistrés dans "travail/documents"
